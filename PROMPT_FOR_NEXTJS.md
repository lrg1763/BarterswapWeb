# ПРОМПТ ДЛЯ СОЗДАНИЯ SKILLSWAP НА NEXT.JS + POSTGRESQL

## ОБЩЕЕ ОПИСАНИЕ ПРОЕКТА

Создай полнофункциональное веб-приложение **SkillSwap** - платформу для peer-to-peer обмена навыками и услугами. Это должно быть современное приложение на **Next.js 14+ (App Router)**, **TypeScript**, **PostgreSQL** в качестве базы данных, с **React Server Components** где это возможно, и клиентскими компонентами для интерактивности.

### Концепция
Платформа позволяет пользователям находить партнеров для взаимного обучения и обмена профессиональными навыками без использования денег. Все взаимодействия основаны на бартерном обмене услугами.

### Референс и вдохновение дизайна
**ВАЖНО**: Использовать сайт **tips.tips** как основное вдохновение для дизайна и UX. Особенности для подражания:
- Чистый, минималистичный дизайн с белым фоном и черным текстом
- Использование светло-зеленого цвета как акцента (как на tips.tips)
- Фиксированный сайдбар навигации слева
- Карточный дизайн контента
- Большое количество белого пространства
- Четкая типографическая иерархия
- Современные, интуитивно понятные интерфейсы
- Плавные переходы и анимации

---

## ТЕХНОЛОГИЧЕСКИЙ СТЕК

### Обязательные технологии:
- **Framework**: Next.js 14+ с App Router
- **Язык**: TypeScript (строгая типизация)
- **База данных**: PostgreSQL (через Prisma ORM)
- **Аутентификация**: NextAuth.js v5 (Auth.js)
- **Реал-тайм коммуникация**: Socket.IO (клиент) + отдельный Socket.IO сервер (Node.js)
- **Стилизация**: Tailwind CSS (без Bootstrap)
- **Валидация форм**: Zod + React Hook Form
- **Загрузка файлов**: Next.js API Routes + Sharp для оптимизации изображений
- **Хеширование паролей**: bcryptjs
- **Вебсокеты**: Socket.IO Client на фронтенде, отдельный Socket.IO сервер для бэкенда

### Дополнительные библиотеки:
- **UI компоненты**: shadcn/ui (или аналогичная библиотека компонентов)
- **Иконки**: Lucide React или Heroicons
- **Уведомления**: sonner или react-hot-toast
- **Анимации**: Framer Motion (опционально, но желательно для плавности)
- **Даты**: date-fns для форматирования дат

---

## СТРУКТУРА БАЗЫ ДАННЫХ (POSTGRESQL)

### Таблица `User` (пользователи)
```sql
id: SERIAL PRIMARY KEY
username: VARCHAR(150) UNIQUE NOT NULL
password: VARCHAR(255) NOT NULL (bcrypt hash)
skills_offered: TEXT DEFAULT '' (навыки, которые предлагает пользователь, через запятую)
skills_needed: TEXT DEFAULT '' (навыки, которые нужны пользователю, через запятую)
location: VARCHAR(150) DEFAULT ''
bio: TEXT DEFAULT '' (биография/описание профиля)
avatar: VARCHAR(255) DEFAULT '' (имя файла аватара, хранится в /public/uploads/avatars/)
rating: DECIMAL(3,1) DEFAULT 0.0 (средний рейтинг от 0 до 5)
is_premium: BOOLEAN DEFAULT FALSE (премиум подписка)
last_seen: TIMESTAMP DEFAULT CURRENT_TIMESTAMP (последний визит)
is_online: BOOLEAN DEFAULT FALSE (статус онлайн/офлайн)
created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
email: VARCHAR(255) UNIQUE (опционально, для будущей функциональности)
```

### Таблица `Message` (сообщения в чатах)
```sql
id: SERIAL PRIMARY KEY
sender_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
receiver_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
content: TEXT NOT NULL (максимум 2000 символов)
timestamp: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
is_read: BOOLEAN DEFAULT FALSE (прочитано ли сообщение)
is_deleted: BOOLEAN DEFAULT FALSE (удалено ли сообщение, soft delete)
is_edited: BOOLEAN DEFAULT FALSE (редактировано ли сообщение)
edited_at: TIMESTAMP NULL (время редактирования)

Индексы:
- CREATE INDEX idx_message_sender_receiver ON Message(sender_id, receiver_id);
- CREATE INDEX idx_message_timestamp ON Message(timestamp DESC);
- CREATE INDEX idx_message_is_read ON Message(is_read) WHERE is_read = FALSE;
```

### Таблица `Review` (отзывы и рейтинги)
```sql
id: SERIAL PRIMARY KEY
reviewer_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
reviewed_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
rating: DECIMAL(2,1) NOT NULL CHECK (rating >= 1 AND rating <= 5) (рейтинг от 1 до 5)
comment: TEXT (максимум 500 символов)
created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Уникальное ограничение:
- UNIQUE(reviewer_id, reviewed_id) - один пользователь может оставить только один отзыв другому

Индексы:
- CREATE INDEX idx_review_reviewed ON Review(reviewed_id);
- CREATE INDEX idx_review_rating ON Review(rating);
```

### Таблица `Favorite` (избранные пользователи)
```sql
id: SERIAL PRIMARY KEY
user_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
favorite_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Уникальное ограничение:
- UNIQUE(user_id, favorite_id)

Индексы:
- CREATE INDEX idx_favorite_user ON Favorite(user_id);
```

### Таблица `Block` (заблокированные пользователи)
```sql
id: SERIAL PRIMARY KEY
blocker_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
blocked_id: INTEGER NOT NULL REFERENCES User(id) ON DELETE CASCADE
created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Уникальное ограничение:
- UNIQUE(blocker_id, blocked_id)

Индексы:
- CREATE INDEX idx_block_blocker ON Block(blocker_id);
```

---

## МАРШРУТЫ И СТРАНИЦЫ

### Публичные страницы (без аутентификации):

#### 1. Главная страница (`/`)
- Красивая landing page с описанием платформы
- Кнопки "Войти" и "Регистрация"
- Информация о возможностях платформы
- Современный дизайн с градиентами (цветовая схема: синий #1a2980 -> голубой #26d0ce)

#### 2. Страница регистрации (`/register`)
- Форма регистрации:
  - Поле username (валидация: минимум 3 символа, максимум 50, только буквы, цифры и подчеркивание)
  - Поле password (минимум 6 символов, максимум 128)
  - Подтверждение пароля
- Валидация на клиенте (Zod) и на сервере
- Обработка ошибок (пользователь уже существует и т.д.)
- После успешной регистрации - редирект на `/login`

#### 3. Страница входа (`/login`)
- Форма входа:
  - Поле username
  - Поле password
  - Чекбокс "Запомнить меня" (опционально)
- Валидация данных
- Обработка ошибок (неверный логин/пароль)
- После успешного входа - редирект на `/profile`

### Защищенные страницы (требуют аутентификации):

#### 4. Профиль пользователя (`/profile`)
- Отображение информации о текущем пользователе:
  - Аватар (или заглушка с первой буквой username)
  - Username
  - Рейтинг (звездочки от 1 до 5, средний рейтинг)
  - Местоположение
  - Дата регистрации
  - Статистика:
    - Количество отзывов
    - Количество сообщений
    - Количество обменов (уникальных собеседников)
- Форма редактирования профиля:
  - Username (с проверкой уникальности)
  - Skills Offered (навыки, которые предлагает, через запятую)
  - Skills Needed (навыки, которые нужны, через запятую)
  - Location (местоположение)
  - Bio (биография, максимум 1000 символов)
  - Загрузка аватара (PNG, JPG, JPEG, GIF, WEBP, максимум 5MB, автоматическое сжатие до 500x500px)
- Последние 5 отзывов о пользователе
- Кнопка "Изменить пароль" (ведет на `/change-password`)

#### 5. Поиск пользователей (`/search`)
- Форма поиска с фильтрами:
  - Поисковый запрос (поиск по username, skills_offered, skills_needed, location, bio)
  - Минимальный рейтинг (слайдер или select от 0 до 5)
  - Фильтр по местоположению (текстовое поле)
  - Сортировка: по рейтингу (убывание/возрастание), по дате регистрации (новые/старые), по имени (A-Z)
- Результаты поиска отображаются карточками пользователей:
  - Аватар
  - Username
  - Рейтинг
  - Местоположение
  - Навыки (предлагаемые и нужные)
  - Кнопка "Просмотреть профиль"
- Исключаются из результатов:
  - Текущий пользователь
  - Заблокированные пользователи (которых заблокировал текущий пользователь или кто заблокировал текущего)
- Пагинация результатов (по 20 пользователей на страницу)
- Возможность поиска как через GET (query params), так и через POST

#### 6. Страница профиля другого пользователя (`/match/[userId]`)
- Полная информация о пользователе (аналогично своему профилю)
- Показ совпадений навыков:
  - Выделить навыки, которые нужны текущему пользователю и предлагает целевой пользователь
  - Показ списка совпадений
- Все отзывы о пользователе (последние 10, с пагинацией)
- Статистика пользователя
- Форма оставления отзыва:
  - Рейтинг (1-5 звезд, обязательно)
  - Комментарий (опционально, максимум 500 символов)
  - Если отзыв уже оставлен - форма позволяет его отредактировать
- Кнопки действий:
  - "Написать сообщение" (переход в чат)
  - "Добавить в избранное" / "Удалить из избранного" (toggle)
  - "Заблокировать пользователя" / "Разблокировать" (toggle)
- Проверка блокировки: если пользователь заблокирован, показывать сообщение "Вы не можете просматривать профиль этого пользователя"

#### 7. Объединенная страница чатов (`/chats` и `/chats/[userId]`)
**КРИТИЧЕСКИ ВАЖНО: Список чатов и окно чата должны быть совмещены в один интерфейс, как в современных мессенджерах (WhatsApp, Telegram, tips.tips).**

**Десктоп версия (>= 768px):**
- Разделенный экран: левая панель со списком чатов (ширина ~350px) + правая панель с активным чатом (flex: 1)
- Левая панель (список чатов):
  - Заголовок "Чаты" вверху
  - Поиск по чатам (опционально, текстовое поле вверху)
  - Список всех собеседников:
    - Аватар собеседника (круглый, 50x50px)
    - Username (Onyx SemiMono Black, weight: 900)
    - Статус онлайн/офлайн (светло-зеленая точка если онлайн, серый круг если офлайн)
    - Последнее сообщение (превью, максимум 50 символов, серый текст)
    - Время последнего сообщения (справа вверху, мелкий серый текст)
    - Счетчик непрочитанных сообщений (светло-зеленый badge с белым текстом, если есть непрочитанные)
  - Сортировка по времени последнего сообщения (самые свежие сверху)
  - Активный чат выделен светло-зеленым фоном или светло-зеленой левой границей
  - Если чатов нет - показать сообщение "У вас пока нет чатов" по центру панели
- Правая панель (активный чат):
  - Если чат не выбран - показать пустое состояние с текстом "Выберите чат для начала общения"
  - Если чат выбран (`/chats/[userId]`):
    - Заголовок чата вверху (белый фон, граница снизу):
      - Аватар собеседника (круглый, 40x40px)
      - Username (жирный)
      - Статус онлайн/офлайн (текст "В сети" светло-зеленым или "Был(а) в сети X минут назад" серым)
      - Кнопка "Просмотреть профиль" (иконка информации, справа)
    - Область сообщений (flex: 1, белый или светло-серый фон):
      - Все сообщения между текущим пользователем и собеседником
      - Сообщения текущего пользователя справа (светло-зеленый фон, черный текст)
      - Сообщения собеседника слева (белый или светло-серый фон, черный текст, с тенью)
      - Время каждого сообщения (формат: HH:MM, мелкий серый текст под сообщением)
      - Если сообщение отредактировано - показывать метку "(отредактировано)" серым мелким текстом и время редактирования
      - Удаленные сообщения не показывать (или показывать как "Сообщение удалено" серым курсивом)
      - Автопрокрутка к последнему сообщению при загрузке и при получении новых
      - Отступы между сообщениями для читаемости
    - Индикатор "Печатает..." (светло-серый текст, слева внизу области сообщений) когда собеседник набирает текст
    - Форма отправки сообщения внизу (белый фон, граница сверху):
      - Текстовое поле (максимум 2000 символов, черный текст, белый фон, граница)
      - Кнопка отправки (светло-зеленая иконка или кнопка справа)
      - Обработка нажатия Enter для отправки (Shift+Enter для новой строки)
    - Функции для сообщений текущего пользователя:
      - При клике/наведении на сообщение - показывать меню с опциями редактирования и удаления
      - При редактировании - показывать inline форму редактирования с сохранением/отменой
- Реал-тайм обновления через Socket.IO:
  - Получение новых сообщений в реальном времени
  - Автоматическое обновление списка чатов (новое сообщение поднимает чат наверх)
  - Индикатор печати
  - Обновление статуса онлайн/офлайн в реальном времени
  - Уведомления о редактировании/удалении сообщений
  - Обновление счетчика непрочитанных сообщений
- При выборе чата - помечать все непрочитанные сообщения от собеседника как прочитанные
- Проверка блокировки: если пользователь заблокирован, показывать сообщение в области чата и блокировать отправку

**Мобильная версия (< 768px):**
- По умолчанию показывать только список чатов (полноэкранный)
- При клике на чат - полный переход на страницу `/chats/[userId]` (полноэкранный чат)
- На странице чата:
  - Кнопка "Назад" (стрелка влево) в заголовке для возврата к списку чатов
  - Полноэкранный интерфейс чата (аналогично десктопу, но без разделения)
  - Все функции работают так же, как на десктопе
- При получении нового сообщения на странице списка чатов - обновление происходит автоматически
- Плавные переходы между списком и чатом (CSS transitions)

#### 9. Избранные пользователи (`/favorites`)
- Список всех пользователей, добавленных в избранное
- Отображение аналогично результатам поиска (карточки)
- Кнопка "Удалить из избранного" на каждой карточке
- Если избранных нет - показать сообщение "У вас пока нет избранных пользователей"

#### 10. Смена пароля (`/change-password`)
- Форма смены пароля:
  - Текущий пароль
  - Новый пароль (валидация: минимум 6 символов)
  - Подтверждение нового пароля
- Валидация на клиенте и сервере
- После успешной смены - редирект на `/profile` с сообщением об успехе

#### 11. Страница подписки (`/subscription`)
- Информация о премиум подписке
- Список преимуществ:
  - Приоритетная поддержка 24/7
  - Расширенные возможности поиска
  - Неограниченное количество избранных
  - Приоритетное отображение в поиске
  - Эксклюзивные функции и возможности
- Кнопка "Оформить подписку" (пока без реальной интеграции платежей)

#### 12. Страница о разработчиках (`/developers`)
- Информация о проекте и разработчиках
- Описание платформы
- Кнопка "Поддержать проект" (модальное окно)

---

## API ENDPOINTS (Next.js API Routes)

### Аутентификация:
- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Вход в систему (NextAuth)
- `POST /api/auth/logout` - Выход из системы
- `GET /api/auth/session` - Получить текущую сессию

### Пользователи:
- `GET /api/users/search` - Поиск пользователей (query params: query, min_rating, location, sort_by, page)
- `GET /api/users/[id]` - Получить информацию о пользователе
- `GET /api/users/me` - Получить текущего пользователя
- `PUT /api/users/me` - Обновить профиль текущего пользователя
- `POST /api/users/me/avatar` - Загрузить аватар (multipart/form-data)
- `GET /api/users/[id]/stats` - Получить статистику пользователя

### Сообщения:
- `GET /api/messages/chat/[userId]` - Получить историю сообщений с пользователем
- `POST /api/messages` - Отправить сообщение (через Socket.IO, но также нужен REST fallback)
- `PUT /api/messages/[id]` - Редактировать сообщение
- `DELETE /api/messages/[id]` - Удалить сообщение (soft delete)
- `GET /api/messages/unread-count` - Получить количество непрочитанных сообщений
- `POST /api/messages/[chatId]/mark-read` - Пометить сообщения как прочитанные

### Отзывы:
- `GET /api/reviews/user/[userId]` - Получить отзывы о пользователе
- `POST /api/reviews` - Создать/обновить отзыв (body: reviewed_id, rating, comment)
- `DELETE /api/reviews/[id]` - Удалить отзыв

### Избранное:
- `GET /api/favorites` - Получить список избранных пользователей
- `POST /api/favorites/[userId]` - Добавить пользователя в избранное (toggle)
- `DELETE /api/favorites/[userId]` - Удалить пользователя из избранного

### Блокировка:
- `POST /api/blocks/[userId]` - Заблокировать/разблокировать пользователя (toggle)
- `GET /api/blocks` - Получить список заблокированных пользователей

---

## SOCKET.IO СЕРВЕР (Отдельный Node.js сервер)

Создай отдельный Socket.IO сервер (например, в папке `socket-server/`) для реал-тайм коммуникации.

### События Socket.IO:

#### Клиент -> Сервер:
- `connect` - Подключение к серверу (с JWT токеном в handshake)
- `join_room` - Присоединение к комнате пользователя (room = userId)
- `send_message` - Отправка сообщения (data: { receiver_id, message })
- `typing` - Индикатор печати (data: { receiver_id, is_typing })
- `edit_message` - Редактирование сообщения (data: { message_id, content })
- `delete_message` - Удаление сообщения (data: { message_id })
- `update_online_status` - Обновление статуса онлайн
- `disconnect` - Отключение от сервера

#### Сервер -> Клиент:
- `receive_message` - Получение нового сообщения (data: { id, sender_id, sender_name, receiver_id, content, timestamp, is_read })
- `user_typing` - Уведомление о печати (data: { user_id, username, is_typing })
- `message_edited` - Уведомление об редактировании сообщения (data: { message_id, content, edited_at })
- `message_deleted` - Уведомление об удалении сообщения (data: { message_id })
- `user_online` - Пользователь стал онлайн (data: { user_id, username })
- `user_offline` - Пользователь стал офлайн (data: { user_id })
- `new_message_notification` - Уведомление о новом сообщении (data: { sender_name, preview, unread_count })
- `error` - Ошибка (data: { message })

### Аутентификация Socket.IO:
- Использовать JWT токены для аутентификации при подключении
- Middleware для проверки токена перед обработкой событий
- Если токен невалиден - отключать клиента

---

## ДИЗАЙН И UI/UX

### Референс дизайна:
- **Сайт для подражания: tips.tips** - использовать как основное вдохновение для дизайна
- Чистый, минималистичный дизайн с акцентом на функциональность
- Фиксированный сайдбар слева (как на tips.tips)
- Большое количество белого пространства для читаемости
- Карточный дизайн для контента
- Использование иконок для визуальной навигации

### Цветовая схема (ОБЯЗАТЕЛЬНО):
- **Основной фон**: `#FFFFFF` (белый)
- **Текст основной**: `#000000` (черный) или `#1a1a1a` (почти черный для лучшей читаемости)
- **Текст вторичный**: `#666666` или `#888888` (серый для подписей, времени и т.д.)
- **Акцентный цвет**: `#90EE90` или `#98FB98` (светло-зеленый, палево-зеленый) - использовать для:
  - Активных элементов меню
  - Кнопок основных действий
  - Badge непрочитанных сообщений
  - Выделения выбранных элементов
  - Статуса "онлайн"
  - Акцентов на карточках
- **Границы**: `#E5E5E5` или `#F0F0F0` (очень светло-серый)
- **Фон карточек**: `#FFFFFF` (белый) или `#FAFAFA` (почти белый для чередования)
- **Тени**: Очень мягкие, едва заметные тени (`rgba(0, 0, 0, 0.05)` - `rgba(0, 0, 0, 0.1)`)
- **Hover состояния**: Светло-серый фон (`#F5F5F5`) при наведении
- **НЕ ИСПОЛЬЗОВАТЬ**: Синие, фиолетовые, красные или другие яркие цвета (кроме светло-зеленого)

### Типографика (ОБЯЗАТЕЛЬНО):
- **Основной шрифт**: **Onyx SemiMono** ('Onyx SemiMono', monospace)
  - Использовать два варианта начертания:
    - **Onyx SemiMono Regular** (weight: 400) - для основного текста, описаний, подписей
    - **Onyx SemiMono Black** (weight: 900) - для заголовков, акцентов, важных элементов
  - Подключить шрифт Onyx SemiMono локально через файлы в `/public/fonts/` (скорее всего, не доступен через Google Fonts)
  - Формат файлов: `.woff2`, `.woff`, или `.ttf`
  - Fallback: моноширинные системные шрифты (monospace)
- **Типографическая иерархия**:
  - Заголовки H1: 32-40px (десктоп), 28-32px (мобильные), **Onyx SemiMono Black** (weight: 900)
  - Заголовки H2: 24-28px (десктоп), 22-24px (мобильные), **Onyx SemiMono Black** (weight: 900)
  - Заголовки H3: 20-24px (десктоп), 18-20px (мобильные), **Onyx SemiMono Black** (weight: 900)
  - Основной текст: 16-18px (десктоп), 14-16px (мобильные), **Onyx SemiMono Regular** (weight: 400)
  - Мелкий текст/подписи: 12-14px (десктоп), 12px (мобильные), **Onyx SemiMono Regular** (weight: 400)
  - Кнопки: 14-16px, **Onyx SemiMono Black** (weight: 900) для основных, **Onyx SemiMono Regular** (weight: 400) для вторичных
  - Username и важные элементы: **Onyx SemiMono Black** (weight: 900)
- **Line-height**: 1.5-1.6 для основного текста, 1.2-1.4 для заголовков
- **Letter-spacing**: нормальный для основного текста, слегка увеличенный (-0.02em до 0.02em) для заголовков

### Компоненты дизайна:
- Современные карточки с очень мягкими тенями и скругленными углами (border-radius: 12-16px)
- Кнопки: белый фон, черная граница, черный текст для вторичных действий; светло-зеленый фон, белый текст для основных действий
- Плавные анимации и переходы (transition: 0.2s-0.3s ease)
- Минималистичный подход - только необходимые элементы
- Четкая типографическая иерархия с использованием шрифта Onyx (размеры шрифтов, жирность как указано выше)

### Сайдбар навигации (как на tips.tips):
- Фиксированный сайдбар слева (ширина: 280-300px на десктопе)
- Белый фон, черный текст
- Логотип/название "SkillSwap" вверху (Onyx SemiMono Black, жирный черный текст)
- Пункты меню (вертикальный список):
  - Каждый пункт: иконка слева + текст
  - Padding: 12-16px вертикально, 20px горизонтально
  - Активный пункт меню: светло-зеленый фон (`#F0FFF0` или `#E8F5E9`) + черный жирный текст
  - Hover: светло-серый фон (`#F5F5F5`)
  - Пункты меню:
    - Профиль (иконка: person/user)
    - Поиск (иконка: search)
    - Чаты (иконка: chat-dots/message, с badge непрочитанных сообщений - светло-зеленый круг с белым числом)
    - Избранное (иконка: heart)
    - Подписка (иконка: gem/star)
    - Разработчики (иконка: code-slash/info)
  - Разделитель (тонкая серая линия)
  - Выход (иконка: box-arrow-right/log-out, внизу, серый цвет)
- На мобильных устройствах (< 768px):
  - Скрывающийся сайдбар (гамбургер-меню в левом верхнем углу)
  - При открытии - overlay (полупрозрачный черный фон) + сайдбар выезжает слева
  - Кнопка закрытия (X) в правом верхнем углу сайдбара
  - При клике на overlay - закрытие сайдбара
  - Плавная анимация появления/исчезновения

### Flash сообщения:
- Уведомления в стиле tips.tips:
  - Успех: белый фон, светло-зеленая левая граница, черный текст, зеленая иконка
  - Ошибки: белый фон, светло-красная/оранжевая левая граница, черный текст, красная иконка (использовать минимально, только для критических ошибок)
  - Предупреждения: белый фон, светло-желтая/оранжевая левая граница, черный текст
- Позиционирование: правый верхний угол с отступом
- Автоматическое закрытие через 5 секунд
- Плавное появление/исчезновение (fade in/out)
- Возможность закрытия вручную (крестик справа)

---

## БЕЗОПАСНОСТЬ

### Валидация:
- Валидация всех пользовательских данных на сервере (Zod схемы)
- Санитизация текста для защиты от XSS (использовать DOMPurify на клиенте и санитизацию на сервере)
- Валидация размера и типа файлов при загрузке аватаров

### Аутентификация и авторизация:
- Хеширование паролей с bcryptjs (salt rounds: 10)
- JWT токены для сессий (через NextAuth.js)
- Middleware для защиты маршрутов (Next.js middleware)
- Проверка прав доступа на каждом API endpoint

### Защита от уязвимостей:
- CSRF защита (встроена в NextAuth.js)
- SQL injection защита (Prisma ORM автоматически экранирует запросы)
- XSS защита (санитизация всех пользовательских данных)
- Rate limiting на API endpoints (опционально, но желательно)

---

## ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### Поиск:
- Поиск должен быть нечувствительным к регистру (case-insensitive)
- Поиск должен работать по частичному совпадению (LIKE '%query%' в SQL)
- При поиске исключать заблокированных пользователей автоматически
- Поддержка поиска на русском языке (кириллица)

### Сообщения:
- Максимальная длина сообщения: 2000 символов
- Автоматическое обновление списка чатов при получении нового сообщения
- Счетчик непрочитанных сообщений должен обновляться в реальном времени
- При открытии чата - автоматически помечать сообщения как прочитанные

### Отзывы:
- Один пользователь может оставить только один отзыв другому пользователю
- При повторной отправке отзыва - обновлять существующий
- При добавлении/обновлении отзыва - автоматически пересчитывать средний рейтинг пользователя
- Отзывы сортируются по дате (новые сверху)

### Статистика:
- Количество отзывов: COUNT(reviews) WHERE reviewed_id = user_id
- Количество сообщений: COUNT(messages) WHERE sender_id = user_id OR receiver_id = user_id
- Количество обменов: COUNT(DISTINCT собеседники) из таблицы messages

### Блокировка:
- При блокировке пользователя:
  - Автоматически удалять его из избранного
  - Скрывать его из результатов поиска
  - Блокировать отправку сообщений
  - Блокировать просмотр профиля (с обеих сторон)
- При разблокировке - восстановление доступа

### Онлайн статус:
- При подключении к Socket.IO - устанавливать is_online = TRUE, обновлять last_seen
- При отключении - устанавливать is_online = FALSE, обновлять last_seen
- Периодическое обновление статуса (heartbeat каждые 30 секунд)
- При показе "последний раз в сети" - форматировать время (например, "5 минут назад", "2 часа назад", "вчера")

---

## ОПТИМИЗАЦИЯ И ПРОИЗВОДИТЕЛЬНОСТЬ

### Загрузка изображений:
- Автоматическое сжатие аватаров до 500x500px при загрузке (использовать Sharp)
- Конвертация в WebP формат для лучшего сжатия
- Оптимизация качества (85%)
- Валидация MIME типов перед сохранением

### Запросы к БД:
- Использовать индексы для часто запрашиваемых полей
- Оптимизировать запросы (избегать N+1 проблем с Prisma)
- Использовать пагинацию для больших списков
- Кэширование статических данных где возможно (Next.js caching)

### Реал-тайм:
- Использовать комнаты Socket.IO для эффективной рассылки сообщений
- Не отправлять события всем подключенным клиентам, только нужным комнатам
- Ограничение частоты отправки событий (rate limiting)

---

## СТРУКТУРА ПРОЕКТА

```
skillswap-nextjs/
├── app/                          # Next.js App Router
│   ├── (auth)/                   # Группа маршрутов для аутентификации
│   │   ├── login/
│   │   │   └── page.tsx
│   │   └── register/
│   │       └── page.tsx
│   ├── (protected)/              # Защищенные маршруты
│   │   ├── profile/
│   │   │   └── page.tsx
│   │   ├── search/
│   │   │   └── page.tsx
│   │   ├── match/
│   │   │   └── [userId]/
│   │   │       └── page.tsx
│   │   ├── chats/
│   │   │   ├── page.tsx                    # Список чатов (мобильная версия) или объединенная страница (десктоп)
│   │   │   └── [userId]/
│   │   │       └── page.tsx                # Активный чат (мобильная версия) или часть объединенной страницы (десктоп)
│   │   ├── favorites/
│   │   │   └── page.tsx
│   │   ├── subscription/
│   │   │   └── page.tsx
│   │   ├── developers/
│   │   │   └── page.tsx
│   │   └── change-password/
│   │       └── page.tsx
│   ├── api/                      # API Routes
│   │   ├── auth/
│   │   │   └── [...nextauth]/
│   │   │       └── route.ts
│   │   ├── users/
│   │   ├── messages/
│   │   ├── reviews/
│   │   ├── favorites/
│   │   └── blocks/
│   ├── layout.tsx                # Root layout (с подключением шрифта Onyx)
│   ├── page.tsx                  # Главная страница
│   └── globals.css               # Глобальные стили (с применением шрифта Onyx)
├── components/                   # React компоненты
│   ├── ui/                       # Базовые UI компоненты (shadcn/ui)
│   ├── layout/
│   │   ├── Sidebar.tsx           # Фиксированный сайдбар навигации
│   │   └── MobileMenu.tsx        # Мобильное меню (гамбургер)
│   ├── chat/
│   │   ├── ChatContainer.tsx     # Объединенный контейнер (список + чат для десктопа)
│   │   ├── ChatList.tsx          # Список чатов (левая панель)
│   │   ├── ChatWindow.tsx        # Окно активного чата (правая панель/полноэкранное)
│   │   ├── MessageBubble.tsx     # Отдельное сообщение
│   │   └── ChatInput.tsx         # Форма ввода сообщения
│   ├── user/
│   │   ├── UserCard.tsx
│   │   ├── UserProfile.tsx
│   │   └── Avatar.tsx
│   └── forms/
│       ├── LoginForm.tsx
│       ├── RegisterForm.tsx
│       └── ProfileForm.tsx
├── lib/                          # Утилиты и хелперы
│   ├── db.ts                     # Prisma client
│   ├── auth.ts                   # NextAuth конфигурация
│   ├── validations.ts            # Zod схемы
│   └── utils.ts                  # Общие утилиты
├── prisma/
│   ├── schema.prisma             # Prisma схема
│   └── migrations/               # Миграции БД
├── public/
│   ├── fonts/                    # Локальные шрифты Onyx SemiMono
│   │   ├── OnyxSemiMono-Regular.woff2    # Onyx SemiMono Regular (weight: 400)
│   │   ├── OnyxSemiMono-Regular.woff
│   │   ├── OnyxSemiMono-Black.woff2      # Onyx SemiMono Black (weight: 900)
│   │   └── OnyxSemiMono-Black.woff
│   └── uploads/
│       └── avatars/              # Загруженные аватары
├── socket-server/                # Отдельный Socket.IO сервер
│   ├── index.ts
│   ├── socket-handlers.ts
│   └── package.json
├── types/                        # TypeScript типы
│   ├── user.ts
│   ├── message.ts
│   └── review.ts
├── middleware.ts                 # Next.js middleware для защиты маршрутов
├── next.config.js
├── package.json
├── tsconfig.json
└── tailwind.config.js            # Конфигурация Tailwind с цветовой схемой (белый, черный, светло-зеленый)
```

---

## ДЕТАЛИ РЕАЛИЗАЦИИ

### Подключение шрифта Onyx SemiMono:
- **Обязательно использовать локальные файлы** (Onyx SemiMono скорее всего не доступен через Google Fonts)
- Использовать `next/font/local` для подключения локальных файлов шрифта в `layout.tsx`:
  ```tsx
  import localFont from 'next/font/local'
  
  const onyxSemiMonoRegular = localFont({
    src: '../public/fonts/OnyxSemiMono-Regular.woff2',
    variable: '--font-onyx-regular',
    weight: '400',
    display: 'swap',
  })
  
  const onyxSemiMonoBlack = localFont({
    src: '../public/fonts/OnyxSemiMono-Black.woff2',
    variable: '--font-onyx-black',
    weight: '900',
    display: 'swap',
  })
  ```
- Альтернативный вариант: подключить через `@font-face` в `globals.css`:
  ```css
  @font-face {
    font-family: 'Onyx SemiMono';
    src: url('/fonts/OnyxSemiMono-Regular.woff2') format('woff2'),
         url('/fonts/OnyxSemiMono-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  
  @font-face {
    font-family: 'Onyx SemiMono';
    src: url('/fonts/OnyxSemiMono-Black.woff2') format('woff2'),
         url('/fonts/OnyxSemiMono-Black.woff') format('woff');
    font-weight: 900;
    font-style: normal;
    font-display: swap;
  }
  
  body {
    font-family: 'Onyx SemiMono', monospace;
    font-weight: 400; /* Regular по умолчанию */
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Onyx SemiMono', monospace;
    font-weight: 900; /* Black для заголовков */
  }
  ```
- Убедиться, что оба варианта шрифта (Regular и Black) загружаются на всех страницах

### NextAuth.js конфигурация:
- Использовать Credentials provider для аутентификации по username/password
- JWT стратегия для сессий
- Callbacks для добавления user.id в сессию
- Защита маршрутов через middleware

### Prisma схема:
- Все модели должны соответствовать SQL схеме выше
- Правильные связи (relations) между моделями
- Каскадное удаление где необходимо
- Индексы для оптимизации запросов

### Загрузка файлов:
- API Route: `POST /api/users/me/avatar`
- Использовать FormData для получения файла
- Валидация размера (максимум 5MB) и типа (PNG, JPG, JPEG, GIF, WEBP)
- Сохранение в `/public/uploads/avatars/[uuid].[ext]`
- Возврат URL файла для обновления в БД

### Реал-тайм чат:
- Socket.IO клиент должен подключаться при монтировании компонента чата
- При отправке сообщения - сначала отправлять через Socket.IO, затем сохранять в БД
- При получении нового сообщения - обновлять UI и помечать как непрочитанное если чат не активен
- Индикатор печати должен исчезать через 3 секунды после последнего ввода
- **ВАЖНО для объединенного интерфейса**: Обновление списка чатов должно происходить в реальном времени (новое сообщение поднимает чат наверх в списке, обновляет превью и время)

### Поиск:
- Server Component для отображения результатов поиска
- Client Component для формы поиска с фильтрами
- Использование Prisma для построения динамических запросов
- Поддержка GET и POST методов для формы поиска

### Валидация форм:
- Zod схемы для всех форм
- React Hook Form для управления состоянием форм
- Отображение ошибок валидации под полями
- Валидация на клиенте и на сервере

### Конфигурация Tailwind CSS:
- Настроить кастомные цвета в `tailwind.config.js`:
  ```js
  colors: {
    primary: {
      white: '#FFFFFF',
      black: '#000000',
      'black-soft': '#1a1a1a',
      'gray-light': '#F5F5F5',
      'gray-medium': '#E5E5E5',
      'gray-text': '#666666',
      'green-light': '#90EE90',  // или #98FB98
      'green-lighter': '#F0FFF0',
    }
  }
  ```
- Настроить шрифт Onyx SemiMono в `tailwind.config.js`:
  ```js
  fontFamily: {
    mono: ['Onyx SemiMono', 'monospace'],
    // или через CSS переменную:
    // mono: ['var(--font-onyx-semi-mono)', 'monospace'],
  },
  extend: {
    fontFamily: {
      'onyx-regular': ['Onyx SemiMono Regular', 'monospace'],
      'onyx-black': ['Onyx SemiMono Black', 'monospace'],
    },
    fontWeight: {
      'onyx-regular': 400,
      'onyx-black': 900,
    }
  }
  ```
- Использовать только эти цвета в проекте
- Не добавлять стандартные цвета Tailwind (blue, purple, red и т.д.) если они не нужны
- **ВАЖНО**: Убедиться, что шрифт Onyx SemiMono подключен и применяется глобально ко всем текстам
- Использовать классы `font-onyx-regular` для обычного текста и `font-onyx-black` для заголовков и акцентов

---

## ДОПОЛНИТЕЛЬНЫЕ ТРЕБОВАНИЯ

### Локализация:
- Весь текст на русском языке
- Форматирование дат и времени на русском (использовать date-fns с русской локалью)

### Адаптивность (уже описано выше в отдельном разделе):
- Полностью адаптивный дизайн - КРИТИЧЕСКИ ВАЖНО
- Mobile-first подход
- Тестирование на всех популярных разрешениях

### Доступность:
- Семантический HTML
- ARIA атрибуты где необходимо
- Поддержка навигации с клавиатуры
- Достаточный контраст цветов

### Обработка ошибок:
- Graceful обработка всех ошибок
- Понятные сообщения об ошибках для пользователя
- Логирование ошибок на сервере
- Fallback UI для критических ошибок

---

## КОМАНДЫ ДЛЯ ЗАПУСКА

После создания проекта должны быть доступны команды:

```bash
# Разработка
npm run dev              # Запуск Next.js dev server
npm run dev:socket       # Запуск Socket.IO server (отдельный процесс)

# База данных
npm run db:generate      # Генерация Prisma client
npm run db:migrate       # Применение миграций
npm run db:studio        # Открыть Prisma Studio

# Билд
npm run build            # Сборка для продакшена
npm start                # Запуск продакшен сервера

# Линтинг и форматирование
npm run lint             # ESLint
npm run format           # Prettier
```

---

## ДЕПЛОЙ НА SPINTHOST

### Требования к хостингу:
- **Хостинг**: SprintHost (sprinthost.ru)
- Поддержка Node.js (версия 18+ или 20+)
- Поддержка PostgreSQL базы данных
- Возможность запуска отдельного процесса для Socket.IO сервера (или интеграция с Next.js)
- SSH доступ для управления сервером

### Подготовка к деплою:

#### 1. Конфигурация окружения:
- Создать файл `.env.production` с переменными:
  ```
  NODE_ENV=production
  DATABASE_URL=postgresql://user:password@host:port/database
  NEXTAUTH_URL=https://yourdomain.com
  NEXTAUTH_SECRET=your-secret-key-here
  SOCKET_SERVER_URL=https://yourdomain.com (или отдельный поддомен)
  ```

#### 2. Адаптация для SprintHost:
- Проверить, поддерживает ли SprintHost отдельные процессы (для Socket.IO сервера)
- Если нет - интегрировать Socket.IO в Next.js API Routes (использовать Socket.IO адаптер для Next.js)
- Настроить статические файлы (uploads/avatars) - убедиться, что они сохраняются и доступны
- Использовать внешнее хранилище для файлов (например, Object Storage) если SprintHost предоставляет, или настроить правильные пути

#### 3. Сборка проекта:
```bash
npm run build
```
- Проверить, что сборка проходит без ошибок
- Оптимизировать bundle size (анализ через `@next/bundle-analyzer`)

#### 4. Настройка базы данных:
- Создать PostgreSQL базу данных на SprintHost
- Применить миграции: `npx prisma migrate deploy`
- Заполнить начальные данные если необходимо

#### 5. Запуск приложения:
- Настроить процесс-менеджер (PM2, если доступен, или встроенный менеджер SprintHost)
- Убедиться, что приложение запускается на правильном порту
- Настроить прокси (nginx или встроенный прокси SprintHost) если необходимо

#### 6. SSL сертификат:
- Настроить HTTPS (Let's Encrypt через SprintHost панель или вручную)
- Обновить NEXTAUTH_URL на https версию

#### 7. Мониторинг и логи:
- Настроить логирование ошибок
- Настроить мониторинг производительности (если доступен)
- Проверить работу Socket.IO соединений через HTTPS

### Альтернативный вариант (Socket.IO через Next.js):
Если SprintHost не поддерживает отдельные процессы, интегрировать Socket.IO напрямую в Next.js:
- Использовать `socket.io` и `socket.io-client`
- Настроить Socket.IO в API Route: `/app/api/socket/route.ts`
- Использовать HTTP long-polling как fallback вместо WebSocket если необходимо

### Оптимизация для продакшена:
- Включить compression (gzip/brotli) на уровне сервера или через Next.js
- Настроить кэширование статических ресурсов
- Оптимизировать изображения (использовать next/image с оптимизацией)
- Настроить CDN для статических файлов если доступен

---

## ВАЖНЫЕ ЗАМЕЧАНИЯ

1. **Шрифт ОБЯЗАТЕЛЬНО**: Использовать шрифт **Onyx SemiMono** для всего текста в проекте. Использовать два варианта:
   - **Onyx SemiMono Regular** (weight: 400) - для основного текста, описаний, подписей
   - **Onyx SemiMono Black** (weight: 900) - для заголовков, username, акцентов, кнопок
   - Подключить локальные файлы шрифта и применить глобально ко всем элементам интерфейса

2. **Цветовая палитра СТРОГО**: Только белый (#FFFFFF), черный (#000000/#1a1a1a) и светло-зеленый (#90EE90/#98FB98). НЕ ИСПОЛЬЗОВАТЬ другие яркие цвета (синий, фиолетовый, красный и т.д.) кроме светло-зеленого для акцентов.

3. **Адаптивность - КРИТИЧЕСКИ ВАЖНО**: Проект должен идеально работать на ВСЕХ устройствах:
   - Мобильные телефоны (320px+)
   - Планшеты (768px+)
   - Ноутбуки и десктопы (1024px+)
   - Большие мониторы (1920px+)
   - Тестировать на реальных устройствах или через DevTools эмуляцию

4. **Объединенный интерфейс чатов**: Список чатов и окно чата должны быть правильно совмещены:
   - Десктоп: split-view (список слева + чат справа)
   - Мобильные: полноэкранные переходы между списком и чатом

5. **Не использовать Bootstrap** - только Tailwind CSS и компоненты из shadcn/ui

6. **TypeScript строгий режим** - все должно быть типизировано

7. **Server Components по умолчанию** - использовать Client Components только когда нужна интерактивность

8. **Безопасность превыше всего** - валидация, санитизация, проверка прав доступа везде

9. **Производительность** - оптимизация изображений, индексы БД, кэширование, особенно важно для мобильных устройств

10. **UX важен** - плавные анимации, понятные сообщения об ошибках, индикаторы загрузки

11. **Дизайн в стиле tips.tips** - использовать как референс для чистоты, минимализма и удобства интерфейса

12. **Хостинг SprintHost** - учитывать особенности и ограничения этого хостинга при разработке и деплое

---

## ФИНАЛЬНЫЕ ЗАМЕЧАНИЯ

Этот промпт описывает полнофункциональное приложение. Начни с базовой структуры проекта, настройки Next.js, Prisma, NextAuth.js, затем последовательно реализуй каждый функционал. Сначала сделай аутентификацию и базовые страницы, затем добавь чат с Socket.IO, и в конце - поиск и все дополнительные функции.

Убедись, что все работает корректно, протестируй основные сценарии использования, и убедись, что код чистый, хорошо структурированный и следует best practices Next.js 14+ и React Server Components.
